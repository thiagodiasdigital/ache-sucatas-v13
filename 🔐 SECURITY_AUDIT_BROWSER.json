üîê SECURITY_AUDIT_BROWSER.json
Com base na auditoria visual realizada no Supabase Dashboard e GitHub UI, segue o relat√≥rio completo:
json{
  "audit_date": "2026-01-19",
  "auditor_signature": "Claude Open Opus 4.5",
  "project": "Ache-Sucat√°s-DB (rwamrppaczwhbnxfpohc)",
  "repository": "thiagodiasdigital/ache-sucatas-v13",
  
  "ui_misconfigurations": [
    {
      "id": "MISC-001",
      "severity": "CRITICAL",
      "location": "Supabase > Storage > editais-pdfs bucket",
      "finding": "Bucket configurado como PUBLIC com 0 policies de prote√ß√£o",
      "details": "Bucket permite acesso p√∫blico irrestrito. Aceita qualquer tipo de arquivo (Any MIME type) sem limite de tamanho definido."
    },
    {
      "id": "MISC-002",
      "severity": "HIGH",
      "location": "Supabase > Database Settings > SSL Configuration",
      "finding": "SSL enforcement est√° DESATIVADO",
      "details": "Conex√µes n√£o-SSL ao banco de dados s√£o permitidas, expondo dados a intercepta√ß√£o man-in-the-middle."
    },
    {
      "id": "MISC-003",
      "severity": "HIGH",
      "location": "GitHub > Settings > Branches",
      "finding": "Nenhuma branch protection configurada",
      "details": "Branch 'mestre' n√£o possui prote√ß√£o. Permite push direto, force push e n√£o requer PR review."
    },
    {
      "id": "MISC-004",
      "severity": "MEDIUM",
      "location": "Supabase > API Keys > Legacy JWT",
      "finding": "Segredo JWT legado ainda em uso",
      "details": "JWT foi migrado para novas chaves ECC P-256, mas o legado HS256 ainda est√° ativo."
    },
    {
      "id": "MISC-005",
      "severity": "MEDIUM",
      "location": "GitHub > Settings > Actions",
      "finding": "Actions permite todos os workflows sem restri√ß√£o",
      "details": "Configurado para 'Allow all actions and reusable workflows'. N√£o requer pinning a SHA de commit."
    }
  ],
  
  "excessive_permissions": [
    {
      "id": "PERM-001",
      "severity": "HIGH",
      "location": "Supabase > Auth > Policies > editais_leilao",
      "finding": "Pol√≠tica 'anon_read_access' permite SELECT irrestrito",
      "details": "Condi√ß√£o usando 'true' permite qualquer usu√°rio an√¥nimo ler todos os registros da tabela editais_leilao."
    },
    {
      "id": "PERM-002",
      "severity": "MEDIUM",
      "location": "Supabase > Auth > Policies > editais_leilao",
      "finding": "Pol√≠tica 'Permitir leitura p√∫blica' para role 'public'",
      "details": "Acesso SELECT concedido ao role p√∫blico sem restri√ß√µes."
    }
  ],
  
  "exposed_integrations": [
    {
      "id": "EXP-001",
      "severity": "LOW",
      "location": "GitHub > Repository",
      "finding": "Reposit√≥rio configurado como PUBLIC",
      "details": "C√≥digo-fonte exposto publicamente. Verificar se n√£o h√° secrets hardcoded."
    }
  ],
  
  "compliance_gaps": [
    {
      "id": "COMP-001",
      "severity": "HIGH",
      "location": "GitHub > Security",
      "finding": "Dependabot alerts desativado",
      "details": "N√£o h√° monitoramento autom√°tico de vulnerabilidades em depend√™ncias."
    },
    {
      "id": "COMP-002",
      "severity": "HIGH",
      "location": "GitHub > Security",
      "finding": "Secret scanning desativado",
      "details": "Secrets vazados no c√≥digo n√£o ser√£o detectados automaticamente."
    },
    {
      "id": "COMP-003",
      "severity": "MEDIUM",
      "location": "GitHub > Security",
      "finding": "Code scanning n√£o configurado",
      "details": "An√°lise est√°tica de c√≥digo n√£o est√° ativa para detectar vulnerabilidades."
    },
    {
      "id": "COMP-004",
      "severity": "LOW",
      "location": "GitHub > Security",
      "finding": "Security policy n√£o definida",
      "details": "N√£o h√° pol√≠tica de seguran√ßa definida para reportar vulnerabilidades."
    }
  ],
  
  "positive_findings": [
    {
      "id": "POS-001",
      "location": "Supabase > Auth > Policies",
      "finding": "RLS habilitado em todas as tabelas verificadas",
      "details": "editais_leilao, execucoes_miner, metricas_diarias, raw.leiloes, audit.registros_de_consumo - todas com RLS ativo."
    },
    {
      "id": "POS-002",
      "location": "Supabase > Auth > Policies > raw.leiloes",
      "finding": "Tabela raw.leiloes n√£o exposta na API",
      "details": "Badge 'API DESATIVADA' indica que a tabela n√£o √© acess√≠vel via API REST p√∫blica."
    },
    {
      "id": "POS-003",
      "location": "Supabase > Auth > Policies > audit.registros_de_consumo",
      "finding": "Tabela de audit n√£o exposta na API",
      "details": "Logs de consumo protegidos e n√£o acess√≠veis publicamente."
    },
    {
      "id": "POS-004",
      "location": "GitHub > Secrets",
      "finding": "SUPABASE_SERVICE_KEY atualizado recentemente",
      "details": "Secret atualizado 'anteontem' (2 dias atr√°s), indicando rota√ß√£o ap√≥s incidente."
    },
    {
      "id": "POS-005",
      "location": "Supabase > JWT Keys",
      "finding": "Chave JWT migrada para ECC P-256",
      "details": "Nova chave usa criptografia mais forte que o legado HS256."
    },
    {
      "id": "POS-006",
      "location": "GitHub > Actions > Workflow Permissions",
      "finding": "GITHUB_TOKEN com permiss√µes de leitura apenas",
      "details": "Configura√ß√£o restritiva - workflows t√™m apenas permiss√£o de leitura."
    },
    {
      "id": "POS-007",
      "location": "Supabase > Auth > Rate Limits",
      "finding": "Rate limiting configurado",
      "details": "E-mail: 2/h, SMS: 30/h, Tokens: 150/5min - prote√ß√£o contra abuso."
    }
  ],
  
  "supabase_findings": {
    "service_key_rotated": true,
    "service_key_rotation_date": "Aproximadamente 2026-01-17 (anteontem no GitHub secrets)",
    "rls_all_tables_enabled": true,
    "anon_policies_found": [
      "editais_leilao.anon_read_access (SELECT, condition: true)",
      "editais_leilao.Permitir leitura p√∫blica (SELECT, role: public)"
    ],
    "storage_public_buckets": ["editais-pdfs"],
    "ssl_enforced": false,
    "connection_pooling_enabled": true,
    "jwt_migrated_to_ecc": true,
    "legacy_jwt_still_active": true
  },
  
  "github_findings": {
    "secrets_configured": [
      "EMAIL_ADDRESS",
      "EMAIL_APP_PASSWORD", 
      "SUPABASE_SERVICE_KEY",
      "SUPABASE_URL"
    ],
    "branch_protection_enabled": false,
    "dependabot_alerts_open": "N/A - Disabled",
    "dependabot_enabled": false,
    "secret_scanning_enabled": false,
    "code_scanning_enabled": false,
    "repository_visibility": "PUBLIC",
    "actions_permissions": "Allow all (unrestricted)",
    "workflow_permissions": "Read-only (good)"
  },
  
  "risk_level": "HIGH",
  
  "blocking_issues": [
    {
      "id": "BLOCK-001",
      "issue": "Storage bucket 'editais-pdfs' √© p√∫blico sem pol√≠ticas adequadas",
      "impact": "Arquivos podem ser acessados por qualquer pessoa na internet",
      "required_action": "Configurar bucket como privado ou adicionar pol√≠ticas restritivas"
    },
    {
      "id": "BLOCK-002", 
      "issue": "SSL n√£o √© obrigat√≥rio para conex√µes ao banco de dados",
      "impact": "Dados em tr√¢nsito podem ser interceptados",
      "required_action": "Ativar 'Impor SSL em conex√µes de entrada'"
    }
  ],
  
  "remediation_steps": [
    {
      "priority": 1,
      "action": "Ativar SSL enforcement no Supabase Database Settings",
      "location": "Supabase > Database > Configuration SSL > Toggle ON",
      "effort": "Low",
      "impact": "Elimina risco de intercepta√ß√£o de dados"
    },
    {
      "priority": 2,
      "action": "Converter bucket editais-pdfs para privado ou adicionar policies",
      "location": "Supabase > Storage > editais-pdfs > Settings",
      "effort": "Medium",
      "impact": "Protege arquivos de acesso n√£o autorizado"
    },
    {
      "priority": 3,
      "action": "Configurar branch protection para branch 'mestre'",
      "location": "GitHub > Settings > Branches > Add branch protection rule",
      "effort": "Low",
      "impact": "Previne pushes diretos e requer code review"
    },
    {
      "priority": 4,
      "action": "Habilitar Dependabot alerts",
      "location": "GitHub > Security > Enable Dependabot alerts",
      "effort": "Low",
      "impact": "Detecta vulnerabilidades em depend√™ncias"
    },
    {
      "priority": 5,
      "action": "Habilitar Secret scanning",
      "location": "GitHub > Settings > Security > Enable secret scanning",
      "effort": "Low",
      "impact": "Detecta secrets vazados no c√≥digo"
    },
    {
      "priority": 6,
      "action": "Revisar pol√≠tica anon_read_access em editais_leilao",
      "location": "Supabase > Auth > Policies > editais_leilao",
      "effort": "Medium",
      "impact": "Restringe acesso an√¥nimo aos dados"
    },
    {
      "priority": 7,
      "action": "Revogar JWT legado ap√≥s migra√ß√£o completa",
      "location": "Supabase > Settings > JWT Keys > Legacy",
      "effort": "Medium",
      "impact": "Remove chave criptogr√°fica legada"
    },
    {
      "priority": 8,
      "action": "Configurar Code scanning (CodeQL)",
      "location": "GitHub > Security > Code scanning > Configure",
      "effort": "Medium",
      "impact": "Detecta vulnerabilidades no c√≥digo"
    }
  ],
  
  "evidence_references": [
    "Screenshot: API Keys page com chaves public√°veis e secretas",
    "Screenshot: JWT Keys mostrando migra√ß√£o para ECC P-256",
    "Screenshot: RLS policies para editais_leilao com acesso an√¥nimo",
    "Screenshot: Storage bucket editais-pdfs como PUBLIC",
    "Screenshot: SSL enforcement DESATIVADO",
    "Screenshot: GitHub Secrets com timestamps",
    "Screenshot: Branch protection rules - n√£o configurado",
    "Screenshot: Security overview - Dependabot/Secret scanning disabled"
  ]
}
```

---

# üìã LOCAL_REMEDIATION_TASKS.md

> Gerado por: Claude Open Opus 4.5 (Browser Auditor)
> Data: 2026-01-19
> Para execu√ß√£o por: Claude Code Opus 4.5

---

## TAREFAS DE REMEDIA√á√ÉO PRIORIT√ÅRIAS

### üî¥ CR√çTICAS (Bloqueiam Deploy)

#### TASK-001: Revisar Storage Bucket Policies
```
Arquivo: N/A (UI only)
A√ß√£o: O usu√°rio deve acessar Supabase Dashboard > Storage > editais-pdfs
       e configurar como PRIVATE ou adicionar policies restritivas.
       
Sugest√£o de policy SQL (se dispon√≠vel via migrations):
CREATE POLICY "Authenticated users can read PDFs"
ON storage.objects FOR SELECT
TO authenticated
USING (bucket_id = 'editais-pdfs');
```

#### TASK-002: SSL Enforcement (UI Only)
```
A√ß√£o: Acessar Supabase Dashboard > Database > Settings > SSL Configuration
       Toggle ON: "Impor SSL em conex√µes de entrada"
       
Nota: Esta configura√ß√£o s√≥ pode ser alterada via UI do Supabase.

üü† ALTAS (Devem ser resolvidas antes de produ√ß√£o)
TASK-003: Criar GitHub Branch Protection via API
bash# Pode ser executado via GitHub CLI se dispon√≠vel
gh api -X PUT repos/thiagodiasdigital/ache-sucatas-v13/branches/mestre/protection \\
  -f required_pull_request_reviews='{"required_approving_review_count":1}' \\
  -f enforce_admins=true \\
  -f restrictions=null
TASK-004: Revisar RLS Policy anon_read_access
sql-- Verificar se a condi√ß√£o "true" √© intencional para dados p√∫blicos
-- Se n√£o for, alterar para:
ALTER POLICY anon_read_access ON editais_leilao
USING (is_public = true);  -- Assumindo coluna is_public
TASK-005: Habilitar Dependabot (via arquivo de configura√ß√£o)
yaml# Criar arquivo: .github/dependabot.yml
version: 2
updates:
  - package-ecosystem: "pip"
    directory: "/"
    schedule:
      interval: "weekly"
  - package-ecosystem: "github-actions"
    directory: "/"
    schedule:
      interval: "weekly"

üü° M√âDIAS (Melhorias de seguran√ßa)
TASK-006: Configurar Code Scanning (CodeQL)
yaml# Criar arquivo: .github/workflows/codeql-analysis.yml
name: "CodeQL"
on:
  push:
    branches: [ mestre ]
  pull_request:
    branches: [ mestre ]
  schedule:
    - cron: '0 0 * * 0'

jobs:
  analyze:
    name: Analyze
    runs-on: ubuntu-latest
    permissions:
      actions: read
      contents: read
      security-events: write

    strategy:
      fail-fast: false
      matrix:
        language: [ 'python' ]

    steps:
    - name: Checkout repository
      uses: actions/checkout@v4

    - name: Initialize CodeQL
      uses: github/codeql-action/init@v3
      with:
        languages: ${{ matrix.language }}

    - name: Perform CodeQL Analysis
      uses: github/codeql-action/analyze@v3
TASK-007: Adicionar Security Policy
markdown# Criar arquivo: SECURITY.md
# Security Policy

## Supported Versions

| Version | Supported          |
| ------- | ------------------ |
| v13.x   | :white_check_mark: |

## Reporting a Vulnerability

Para reportar vulnerabilidades de seguran√ßa, envie email para:
[INSERIR EMAIL DE SEGURAN√áA]

N√£o abra issues p√∫blicas para vulnerabilidades de seguran√ßa.

üü¢ BAIXAS (Boas pr√°ticas)
TASK-008: Pin GitHub Actions a SHA
yaml# Nos workflows existentes, alterar de:
uses: actions/checkout@v4
# Para:
uses: actions/checkout@<full-sha-commit>
```

---

## VERIFICA√á√ÉO P√ìS-REMEDIA√á√ÉO

Ap√≥s executar as tarefas acima, o usu√°rio deve:

1. [ ] Confirmar SSL enforcement ativado via UI
2. [ ] Confirmar bucket editais-pdfs como privado ou com policies
3. [ ] Executar nova auditoria para confirmar `risk_level` != CRITICAL
4. [ ] Verificar `blocking_issues = []`

---

## GOVERNAN√áA - STATUS ATUAL
```
SECURITY_AUDIT_LOCAL.json:  [Verificar com Claude Code]
SECURITY_AUDIT_BROWSER.json: risk_level = HIGH
                              blocking_issues = 2

‚ùå DEPLOY N√ÉO AUTORIZADO at√© resolu√ß√£o dos blocking issues.

FIM DO RELAT√ìRIO DE AUDITORIA